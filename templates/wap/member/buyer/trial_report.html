{include template('header','common')}
	<div id="wrapper">
		<div id="header-style">
			<a href="javascript:;" onclick="javascript:history.back(-1);" class="skip fl"></a>
			<strong class="d-block uset-t-text ">填写试用报告</strong>
		</div>
		<style type="text/css">
			body .set-c-w{
				width:95.15625%;
				margin:0 auto;
			}
			.ap-shop-mess{
				height:5.944444444444444em;
				overflow:hidden;
				padding-top:1em;
			}
			.ap-shop-mess .left{
				width:18%;
				height:100%;
			}
			.ap-shop-mess .left img{
				width:100%;
				height:100%;
			}
			.ap-shop-mess .right{
				width:77%;
				padding-left:5%;
				height:100%;
			}
			.ap-shop-mess .right ul li{
				float:left;
				width:10%;
				height:100%;
				background:url({THEME_STYLE_PATH}style/default/images/ap-icon.png) no-repeat top center;
				background-size:auto 200%;
			}
			.ap-shop-mess .right ul{
				height:100%;
			}
			.ap-shop-mess .right dl{
				height:100%;
			}
			.ap-shop-mess .right dt{
				font-size:2em;
				height:1.583333333333333em;
			}
			.ap-shop-mess .right dd{
				height:2.777777777777778em;
			}
			.ap-shop-mess .right ul .i-on{
				background-position-y:top;
			}
			.ap-shop-mess .right ul .i-off{
				background-position-y:bottom;
			}
			.improtw-w{
				width:98.8%;
			}
			.improtw-w textarea{
				width:100%;
				height:100%;
				background:#f0f0f0;
				border-color:#a0a0a0;
			}
			.ap-user-improt h3{
				font-size:1.666666666666667em;
				line-height:1.666666666666667em;
				color:#000;
			}
			.ap-user-mess{
				content:"";
				zoom:1;
				clear:both;
			}
			.ap-user-mess li{
				width:50%;
				float:left;
				margin-top:1em;
				line-height:2em;
			}
			.ap-user-mess li input{
				height:1.95em;
				line-height:1.5em;
				width:47.54098360655738%;
				border:solid 1px #a0a0a0;
				margin:0 0.5em;
			}
			.ap-course h3{
				font-size:1.5em;
				color:#000;
				line-height:2.2em;
			}
			.ap-c-add{
				overflow:hidden;
			}
			.ap-c-add li{
				float:left;
				height:5.833333333333333em;
				padding-bottom:1em;
				padding-right:1em;
			}
			.ap-c-add li img{
				height:100%;
			}
			.btn-submit{
				padding:1em 0 3em 0;
			}
			.btn-submit input{
				width:49.5%;
				font-size:1.666666666666667em;
				display:block;
				height:2em;
				text-align:center;
				margin:0 auto;
			}
		</style>
		<div class="content set-c-w">
            <form action="{U('order/trial_report')}" method="post" id='myform'>
            <input type='hidden' name='order_id' value="{$order_id}"/>
			<div class="ap-shop-mess">
				<a href="#" class="clear">
					<span class="left fl">
						<img src="{$product['thumb']}" alt="{$product['title']}" />
					</span>
					<script type="text/javascript">
						$(function(){
							$('#icon-show li').click(function(){
								$('#icon-show li').removeClass('i-on').addClass('i-off');
								var now = $(this).index()+1;
								for(var i=0;i<now;i++){
									$('#icon-show li:eq('+i+')').removeClass('i-off').addClass('i-on');
								}
                                $("#star").val(now);
							});
						});
					</script>
					<span class="right fl">
						<dl>
							<dt>{$product['title']}</dt>
							<dd>
								<ul id="icon-show">
									<li class='i-on'></li>
									<li class='i-on'></li>
									<li class='i-on'></li>
									<li class='i-on'></li>
									<li class='i-on'></li>
								</ul>
							</dd>
						</dl>
					</span>
                    <input type="hidden" id="star" name="report[star]" value="5" />
				</a>
			</div>
			<div class="ap-user-improt">
				<h3>填写试客背景</h3>
				<div class="improtw-w">
					<textarea name="report[background]" id="background" cols="30" rows="10" class="discuss_v">500字以内如：在2014立夏之际，第一次成功申请试用就获得了我很中意的一款背心，很高兴，很激动，也很荣幸。感谢云划算试用提供的试用平台，也感谢快递大哥的辛苦派送，最感谢的是店家...</textarea>
				</div>
                <script type="text/javascript">
                    var aT =  $('.discuss_v:eq(0)').text();
                    $('.discuss_v').focus(function(){ $(this).text(''); });
                    $('.discuss_v').blur(function(){ if($('.discuss_v:eq(0)').text() != aT+'' && $('.discuss_v:eq(0)').text() == 0 ){ $(this).text(aT); } });
                </script>
			</div>
			<div class="ap-user-mess">
				<ul>
					<li>身高<input type="text" name="report[height]" id="height"/>CM</li>
					<li>体重<input type="text" name="report[weight]" id="weight"/>KG</li>
					<li>年龄<input type="text" name="report[age]" id="age"/>岁</li>
					<li>职业<input type="text" name="report[job]" id="job"/></li>
				</ul>
			</div>
			<div class="ap-course">
				<h3>试用过程及体验</h3>
				<ul class="ap-c-add" id="img1">
					<li><a href="#"><img src="{THEME_STYLE_PATH}style/default/images/add-btn.png" alt="" /></a></li>
				</ul>
                <div style="display: none" id="show_msg"></div>
				<div class="hr"></div>
				<div class="improtw-w">
					<textarea cols="30" rows="9" name="report[content]"></textarea>
				</div>
			</div>
			<p class="btn-submit"><input type="submir" value="发布" class="btn-s-01 onsubmit"/></p>
            </form>
		</div>		
{include template('footer','common')}

<link href="{JS_PATH}webuploader/webuploader.css" rel="stylesheet" />
<script src="{JS_PATH}webuploader/webuploader.js" type="text/javascript"></script>

<!-- 校验提交数据 -->
<script language="javascript" type="text/javascript" src="<?php echo JS_PATH?>formvalidator.js" charset="UTF-8"></script>
<script language="javascript" type="text/javascript" src="<?php echo JS_PATH?>formvalidatorregex.js" charset="UTF-8"></script>
<script>
    function dosub(){
        var background = '500字以内如：在2014立夏之际，第一次成功申请试用就获得了我很中意的一款背心，很高兴，很激动，也很荣幸。感谢云划算试用提供的试用平台，也感谢快递大哥的辛苦派送，最感谢的是店家...';
        if ($('#background').val() == '' || $('#background').val() == background){
            alert('请填写试客背景');return false;
        }
        $('#myform').submit();
    }

    $(function(){
        $.formValidator.initConfig({
            formid:"myform",
            autotip:true,
            onerror:function(msg,obj){
                $(obj).focus();
            }
        });
        // 校验输入的身高值
        $("#height").formValidator({
            empty:false,
            onempty:'身高不能为空',
            onshow:'请输身高(正整数)' ,
            onfocus:"请输入身高(正整数)"
        }).functionValidator({
            fun:function(val){
                if (val < 50 || val > 260){
                    return '身高的范围是 50~260';
                }
                return true;
            }
        }).regexValidator({
            regexp:'intege1',
            datatype:'enum',
            onerror:'身高只能为正整数'
        });
        // 体重
        $("#weight").formValidator({
            empty:false,
            onempty:'体重不能为空',
            onshow:'请输体重(正整数)' ,
            onfocus:"请输入体重(正整数)"
        }).functionValidator({
            fun:function(val){
                if (val < 20 || val > 400){
                    return '体重的范围是 20~400';
                }
                return true;
            }
        }).regexValidator({
            regexp:'intege1',
            datatype:'enum',
            onerror:'体重只能为正整数'
        });
        // 年龄
        $("#age").formValidator({
            empty:false,
            onempty:'年龄不能为空',
            onshow:'请输年龄(正整数)' ,
            onfocus:"请输入年龄(正整数)"
        }).functionValidator({
            fun:function(val){
                if (val < 10 || val > 130){
                    return '年龄的范围是 10~130';
                }
                return true;
            }
        }).regexValidator({
            regexp:'intege1',
            datatype:'enum',
            onerror:'年龄只能为正整数'
        });
        // 职业
        $("#job").formValidator({
            empty:false,
            onempty:'职业不能为空',
            onshow:'请输您的职业' ,
            onfocus:"请输入您的职业"
        }).regexValidator({
            regexp:'ps_username',
            datatype:'enum',
            onerror:'职业可以为中文、字母'
        });
    })

    $(document).ready(function(){
        var uploader = WebUploader.create({
            auto:true,
            fileVal:'Filedata',
            // swf文件路径
            swf: '{JS_PATH}webuploader/webuploader.swf',
            // 文件接收服务端。
            server: "{U('Attachment/Attachment/swfupload')}",
            // 选择文件的按钮。可选
            formData:{
                "module":"",
                "catid":"",
                "userid":"1",
                "dosubmit":"1",
                "thumb_width":"0",
                "thumb_height":"0",
                "watermark_enable":"1",
                "filetype_post":"jpg|jpeg|gif|bmp|png",
                "swf_auth_key":"57a39f6f7415ec2cdd2b8afd77b57c3f",
                "isadmin":"1",
                "groupid":"2"
            },
            // 内部根据当前运行是创建，可能是input元素，也可能是flash.
            pick: {
                id: '#img1',
                multiple:false
            },
            accept:{
                title: '图片文件',
                extensions: 'gif,jpg,jpeg,bmp,png',
                mimeTypes: 'image/*'
            },
            thumb:{
                width: '110',
                height: '110'
            },
            chunked: false,
            chunkSize:1000000,
            // 不压缩image, 默认如果是jpeg，文件上传前会压缩一把再上传！
            resize: false
        });

        uploader.onUploadSuccess = function( file, response ) {
            var pickid = this.options.pick.id;
            var data = response._raw;
            var arr = data.split(',');
            if(arr[0] > 0) {
//                $(pickid).find('img').attr('src', arr[1]);
//                $(pickid).find('input[type=hidden]').eq(0).attr('value', arr[1]);
                var li = '<li><img src="'+arr[1]+'"></li>'
                $(".webuploader-pick").append(li);
                var input = '<input type="hidden" value="'+arr[1]+'" name="report[images][]" id="file_url">';
                $("#show_msg").append(input);
            }
        }

        uploader.onUploadError = function(file, reason) {
            alert('文件上传错误：' + reason);
        }
    })

    $(".onsubmit").click(function(){
        $("#myform").submit();
    })
</script>